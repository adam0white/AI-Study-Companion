# Story 4.4: Subject-Specific Progress Views

Status: ready-for-development

## Story

**As a** student focused on improving specific subjects,
**I want** detailed progress views for each subject I'm learning,
**so that** I can see my mastery trajectory and identify improvement areas within each subject.

## Acceptance Criteria

1. **AC-4.4.1:** Subject overview shows all 8 subjects with mastery at a glance
   - SubjectProgressOverview component displays 8 subject cards (via SUBJECTS constant from Story 4.3)
   - Each card shows: subject name, current mastery %, trend (up/down/stable)
   - Sorted by mastery score descending (highest → lowest) by default
   - Alternative sort: by subject name alphabetically
   - Color coding: red (0-30%), yellow (30-70%), green (70-100%)
   - Quick access to detailed view for each subject
   - Responsive grid layout (mobile: 1 col, tablet: 2 cols, desktop: 3-4 cols)
   - Loading states with skeleton loaders while data fetches

2. **AC-4.4.2:** Subject detail view shows mastery progression over time
   - SubjectDetailView component (EXISTING - enhanced in Story 4.4) displays single subject data in depth
   - Shows current mastery percentage prominently with visual indicator
   - Timeline of mastery changes via ProgressOverTimeChart component (existing)
   - Practice session count, last practice date, average accuracy
   - Confidence level of mastery assessment: based on practice_count (min(count/10, 1.0))
   - "Back to Overview" navigation button
   - Responsive layout with clear visual hierarchy

3. **AC-4.4.3:** Visual timeline shows mastery trajectory (leverage ProgressOverTimeChart)
   - SubjectProgressTimeline component uses existing ProgressOverTimeChart
   - X-axis: Time (date range: last 30 days by default, expandable to 7/90/all-time)
   - Y-axis: Mastery score (0.0-1.0 scale as decimal percentage)
   - Line chart showing mastery curve with data points per practice session
   - Hover tooltips showing exact date and mastery score
   - Color gradient based on trend: green (rising), red (falling), blue (stable)
   - Responsive and mobile-friendly

4. **AC-4.4.4:** Subject comparison view shows relative progress
   - SubjectComparisonChart component displays mastery across all 8 subjects
   - Bar chart showing all 8 subjects with mastery values (0.0-1.0)
   - Visual identification of strongest/weakest subjects via color coding
   - Time range filter: "last 7 days", "last 30 days", "all time"
   - Hover tooltips with exact mastery percentages and session counts
   - Visual color indicators for improvement areas (red = <30%, yellow = 30-70%, green = 70%+)

5. **AC-4.4.5:** Practice statistics for each subject
   - Shows: total practice sessions, average score (0-100%), longest streak (days), current streak
   - Session count and average accuracy retrieved from practice_sessions table via RPC
   - Streak: consecutive calendar days with ≥1 practice session in subject
   - Statistics displayed in subject detail view and comparison chart
   - Real-time updates after each practice completion via React Query invalidation

6. **AC-4.4.6:** Subject progress integrates with practice interface
   - SubjectDetailView includes "Practice This Subject" button
   - Button opens practice modal/flow with correct subject pre-selected
   - Integrates with existing practice flow (from Story 3.0)
   - After practice completes: return to detail view with updated mastery
   - Clear visual feedback during practice and after completion

7. **AC-4.4.7:** Data persistence and real-time updates
   - All mastery data from Story 4.3 subject_mastery table (source of truth)
   - Practice stats calculated from practice_sessions and practice_questions tables
   - Real-time updates via React Query cache invalidation on practice completion
   - Charts re-render when mastery or stats data changes
   - No page refresh required for data updates
   - Loading states during data fetch with error handling

## Tasks / Subtasks

- [ ] **Task 1: Create SubjectProgressOverview Component** (AC: 4.4.1)
  - [ ] Component: `src/components/progress/SubjectProgressOverview.tsx`
  - [ ] Display 8 subject cards in responsive grid (2x4 or 3x3)
  - [ ] Each card shows: subject name, mastery %, trend icon (↑/↓/→)
  - [ ] Card click navigates to SubjectDetailView for that subject
  - [ ] Sort buttons: by mastery (descending), by name (a-z)
  - [ ] Color coding based on mastery range
  - [ ] Responsive design (mobile: 1 column, tablet: 2 columns, desktop: 4 columns)
  - [ ] Skeleton loaders while data fetches
  - [ ] Test: All 8 subjects display correctly
  - [ ] Test: Sorting works for both options
  - [ ] Test: Card styling and colors correct
  - [ ] Test: Navigation to detail view

- [ ] **Task 2: Create SubjectDetailView Component** (AC: 4.4.2)
  - [ ] Component: `src/components/progress/SubjectDetailView.tsx`
  - [ ] Header: subject name, current mastery large/prominent
  - [ ] Display: practice session count, last practice date, last practice score
  - [ ] Confidence level: based on number of practice sessions (more = more confident)
  - [ ] Mastery progression graph (simple line or area chart)
  - [ ] Embed SubjectProgressTimeline component
  - [ ] Section: Practice Statistics (from AC-4.4.5)
  - [ ] Button: "Practice This Subject" (opens practice with subject pre-selected)
  - [ ] Button: "Back to Overview"
  - [ ] Responsive design for all screen sizes
  - [ ] Test: Detail view displays correctly
  - [ ] Test: Timeline loads and renders
  - [ ] Test: Navigation buttons work

- [ ] **Task 3: Create SubjectProgressTimeline Component** (AC: 4.4.3)
  - [ ] Component: `src/components/progress/SubjectProgressTimeline.tsx`
  - [ ] Chart library: Recharts (or similar for React)
  - [ ] Line chart showing mastery progression over time
  - [ ] X-axis: dates (last 30 days by default)
  - [ ] Y-axis: mastery score (0.0 to 1.0)
  - [ ] Data points: one per practice session
  - [ ] Color gradient: green (mastery rising), red (mastery falling), blue (stable)
  - [ ] Hover tooltips: date + exact mastery score
  - [ ] Time range selector: 7 days, 30 days, 90 days, all time
  - [ ] Optional: show average mastery line
  - [ ] Loading state while data fetches
  - [ ] Test: Timeline renders with correct data
  - [ ] Test: Hover tooltips display
  - [ ] Test: Time range selector updates chart

- [ ] **Task 4: Create SubjectComparisonChart Component** (AC: 4.4.4)
  - [ ] Component: `src/components/progress/SubjectComparisonChart.tsx`
  - [ ] Bar chart or radar chart with all 8 subjects
  - [ ] Y-axis: mastery score (0.0 to 1.0)
  - [ ] X-axis: subject names (or arranged in radar circle)
  - [ ] Color coding: by mastery range (red/yellow/green)
  - [ ] Time range filter: last 7 days, 30 days, all time
  - [ ] Hover tooltips: exact mastery for each subject
  - [ ] Visual guides: 0%, 25%, 50%, 75%, 100% markers
  - [ ] Click on subject: navigate to detail view
  - [ ] Responsive: bar chart for mobile, radar option for desktop
  - [ ] Loading state while data fetches
  - [ ] Test: Chart renders all 8 subjects
  - [ ] Test: Correct mastery values displayed
  - [ ] Test: Time range filtering works
  - [ ] Test: Click navigation works

- [ ] **Task 5: Implement Practice Statistics Calculation** (AC: 4.4.5)
  - [ ] Function: `calculateSubjectStats(subject: string)` in StudentCompanion
  - [ ] Calculate: total sessions, average score, longest streak
  - [ ] Query: practice_sessions and practice_questions tables
  - [ ] Average score: sum(correct) / sum(total) per subject
  - [ ] Streak: consecutive days with ≥1 practice session
  - [ ] Cache stats for 5 minutes (invalidate after practice)
  - [ ] Return stats interface: { totalSessions, averageScore, longestStreak, currentStreak }
  - [ ] Handle no data case (return 0 values)
  - [ ] Test: Stats calculated correctly from practice data
  - [ ] Test: Streak calculation handles gaps
  - [ ] Test: Caching works

- [ ] **Task 6: Create RPC Method for Subject Statistics** (AC: 4.4.5)
  - [ ] Add `getSubjectStats(subject: string)` RPC method
  - [ ] Returns: { totalSessions: number, averageScore: number, longestStreak: number, currentStreak: number }
  - [ ] Calls calculateSubjectStats internally
  - [ ] Update RPC types in `src/lib/rpc/types.ts`
  - [ ] Update RPC client in `src/lib/rpc/client.ts` with React Query
  - [ ] Test: RPC method returns correct stats

- [ ] **Task 7: Integrate Progress Views into Companion UI** (AC: 4.4.6, 4.4.1)
  - [ ] Update ProgressCard component to include tabs/sections
  - [ ] Tab 1: Overall Progress (existing)
  - [ ] Tab 2: Subject Overview (new - SubjectProgressOverview)
  - [ ] Tab 3: Detailed Breakdown (shows SubjectDetailView when subject selected)
  - [ ] Tab 4: Subject Comparison (SubjectComparisonChart)
  - [ ] Clear navigation between views
  - [ ] Styling consistent with existing UI
  - [ ] Test: Tabs display and switch correctly
  - [ ] Test: Data loads in each tab

- [ ] **Task 8: Implement Real-Time Updates** (AC: 4.4.7)
  - [ ] On practice session complete: invalidate subject mastery cache
  - [ ] On practice session complete: invalidate subject stats cache
  - [ ] React Query automatic refetch of stale data
  - [ ] Charts update without page refresh
  - [ ] Loading states during refetch
  - [ ] Error boundaries for failed data loads
  - [ ] Test: Data updates after practice completion
  - [ ] Test: Charts re-render with new data

- [ ] **Task 9: Create Navigation from Detail View to Practice** (AC: 4.4.6)
  - [ ] SubjectDetailView: "Practice This Subject" button
  - [ ] Button opens practice modal/flow with subject pre-selected
  - [ ] Integrates with existing practice flow from Story 3.0
  - [ ] After practice completes: return to detail view
  - [ ] Show loading state during practice
  - [ ] Display confirmation when practice completes
  - [ ] Test: Navigation to practice works
  - [ ] Test: Subject pre-filled in practice interface
  - [ ] Test: Return to detail view after practice

- [ ] **Task 10: Write Unit Tests for Statistics Calculation** (AC: 4.4.5)
  - [ ] Create test file: `src/lib/mastery/statistics.test.ts`
  - [ ] Test: calculateSubjectStats with various practice data
  - [ ] Test: Average score calculated correctly
  - [ ] Test: Streak calculation with consecutive days
  - [ ] Test: Streak resets on missing day
  - [ ] Test: Handle no sessions case
  - [ ] Use Vitest
  - [ ] Verify all tests pass

- [ ] **Task 11: Write Component Tests for Progress Views** (AC: 4.4.1, 4.4.2, 4.4.3, 4.4.4)
  - [ ] Create test files:
    - `src/components/progress/SubjectProgressOverview.test.tsx`
    - `src/components/progress/SubjectDetailView.test.tsx`
    - `src/components/progress/SubjectProgressTimeline.test.tsx`
    - `src/components/progress/SubjectComparisonChart.test.tsx`
  - [ ] Test: Components render with mock data
  - [ ] Test: Navigation between views works
  - [ ] Test: Sorting/filtering controls work
  - [ ] Test: Charts render correctly
  - [ ] Test: Hover tooltips display
  - [ ] Use React Testing Library + Vitest
  - [ ] Verify all tests pass

- [ ] **Task 12: Write Integration Tests for Full Progress Flow** (AC: All)
  - [ ] Create test file: `src/components/progress/ProgressFlow.test.tsx`
  - [ ] Test: Navigate from overview → detail → practice → back to detail
  - [ ] Test: Mastery updates after practice completion
  - [ ] Test: Charts update with new data
  - [ ] Test: Data persists across navigation
  - [ ] Test: Real-time updates work (cache invalidation)
  - [ ] Use Vitest + React Testing Library
  - [ ] Verify integration tests pass

- [ ] **Task 13: Implement Responsive Design** (AC: All components)
  - [ ] Mobile (< 768px): single column layouts, stacked cards
  - [ ] Tablet (768px - 1024px): 2-column layouts
  - [ ] Desktop (> 1024px): 4-column or full-width layouts
  - [ ] Charts scale responsively
  - [ ] Touch-friendly buttons and clickable areas (min 44px)
  - [ ] Readable text on all screen sizes
  - [ ] Test: Layout on mobile, tablet, desktop

- [ ] **Task 14: Accessibility (a11y) Implementation** (AC: All components)
  - [ ] ARIA labels for charts and interactive elements
  - [ ] Keyboard navigation: Tab through all elements
  - [ ] Color contrast: WCAG AA standards (4.5:1 for text)
  - [ ] Alt text for chart descriptions
  - [ ] Screen reader compatible (test with VoiceOver/NVDA)
  - [ ] Semantic HTML (nav, section, article tags)
  - [ ] Test: Keyboard navigation works
  - [ ] Test: Screen reader reads content correctly
  - [ ] Test: Color contrast meets WCAG AA

- [ ] **Task 15: Create User Documentation** (AC: All)
  - [ ] In-app tooltips for each view (how to interpret data)
  - [ ] Help text for sorting/filtering controls
  - [ ] Legend for color coding (red/yellow/green meaning)
  - [ ] Explanation of mastery formula and confidence
  - [ ] How to improve mastery (practice more, focus on weak areas)
  - [ ] FAQ: What do these numbers mean?

- [ ] **Task 16: Performance Optimization** (AC: 4.4.7)
  - [ ] Lazy load components (load on tab click)
  - [ ] Memoize expensive computations (React.memo for chart components)
  - [ ] Optimize chart re-renders (only when data changes)
  - [ ] Limit data range for timeline (don't load all historical data)
  - [ ] Pagination for large practice session lists
  - [ ] Virtual scrolling if needed (many sessions)
  - [ ] Test: Component performance with large datasets

## Dev Notes

### Component Architecture

**Component Tree:**

```
ProgressView (top level)
├── ProgressTabs
│   ├── Tab 1: OverallProgress (existing)
│   ├── Tab 2: SubjectProgressOverview (new)
│   │   └── SubjectCard (×8) → SubjectDetailView
│   ├── Tab 3: SubjectDetailView (new)
│   │   ├── SubjectProgressTimeline
│   │   ├── PracticeStatistics
│   │   └── "Practice This Subject" Button
│   └── Tab 4: SubjectComparisonChart (new)
```

**Component Responsibilities:**

1. **SubjectProgressOverview**: NEW - Grid of all 8 subject cards (composes existing SubjectProgressCard)
2. **SubjectDetailView**: ENHANCE existing - Add "Practice This Subject" button + confidence level display
3. **SubjectProgressTimeline**: NEW - Wrapper component using existing ProgressOverTimeChart for subject-specific view
4. **SubjectComparisonChart**: NEW - Bar chart comparing all 8 subjects with time-range filtering
5. **PracticeStatistics**: Display section within detail view showing stats (sessions, avg score, streaks)

### Data Requirements

**Primary Data Source - Story 4.3 (Subject Knowledge Tracking):**
- `subject_mastery` table via `getSubjectMastery()` RPC method
  - Fields: subject, mastery_score (0.0-1.0), practice_count, last_updated
  - Source of truth for mastery visualization
  - Already exported via Story 4.3 RPC implementation

**Secondary Data Source - Practice History:**
- `practice_sessions` table: subject, completed_at, questions_total, questions_correct
- `practice_questions` table: correct_answer, student_answer, created_at
- Used to calculate practice statistics and streaks

**Computed Data (Derived):**
- Trend (mastery change): comparison of current vs. previous mastery (24-hour, 7-day, 30-day)
- Average score: sum(questions_correct) / sum(questions_total) per subject
- Longest streak: consecutive calendar days with ≥1 practice session
- Current streak: consecutive days continuing to present (0 if broken)
- Confidence level: min(practice_count / 10, 1.0) - more practice = more confidence in mastery assessment

### Mastery Confidence Calculation

**Formula:**
```
confidence = min(practice_count / 10, 1.0)
```

| Practice Count | Confidence | Level |
|---|---|---|
| 0 | 0% | No data |
| 1-3 | 10-30% | Low confidence |
| 4-7 | 40-70% | Medium confidence |
| 8-10 | 80-100% | High confidence |
| 10+ | 100% | Very high confidence |

Displayed as visual indicator: low (grey), medium (yellow), high (green)

### Chart Libraries and Options

**Recharts** (recommended):
- React-friendly, TypeScript support
- Line charts (mastery timeline)
- Bar charts (comparison)
- Composable API
- Good documentation

**Alternative: Chart.js**
- Popular, lightweight
- Requires wrapper for React integration
- Good for all chart types

**Trend Color Logic:**
```typescript
const getTrendColor = (oldMastery: number, newMastery: number): string => {
  if (newMastery > oldMastery + 0.05) return '#10b981'; // green (up)
  if (newMastery < oldMastery - 0.05) return '#ef4444'; // red (down)
  return '#3b82f6'; // blue (stable)
};
```

### Streak Calculation Algorithm

**Consecutive Days Calculation:**

```typescript
function calculateStreak(practiceSessionDates: string[]): { longest: number, current: number } {
  const dates = practiceSessionDates
    .map(d => new Date(d).toDateString())
    .filter((v, i, a) => a.indexOf(v) === i) // unique dates
    .sort();

  let longest = 0;
  let current = 0;
  let lastDate: Date | null = null;

  for (const dateStr of dates) {
    const date = new Date(dateStr);

    if (!lastDate) {
      current = 1;
    } else {
      const daysDiff = Math.floor((date.getTime() - lastDate.getTime()) / (1000 * 60 * 60 * 24));
      if (daysDiff === 1) {
        current++;
      } else {
        longest = Math.max(longest, current);
        current = 1;
      }
    }
    lastDate = date;
  }

  longest = Math.max(longest, current);

  // Check if current streak is still active (last practice was today or yesterday)
  const today = new Date().toDateString();
  const yesterday = new Date(Date.now() - 86400000).toDateString();
  const lastPractice = dates[dates.length - 1];

  const currentActive = lastPractice === today || lastPractice === yesterday;

  return {
    longest,
    current: currentActive ? current : 0
  };
}
```

### Time Range Options

**Default: 30 days**

Available ranges:
- 7 days: recent progress
- 30 days: typical sprint view (default)
- 90 days: quarterly progress
- All time: entire learning history

Each range loads appropriate data from D1:
```typescript
const startDate = new Date();
startDate.setDate(startDate.getDate() - days);
const sessions = await db
  .select()
  .from(practice_sessions)
  .where(sql`date(completed_at) >= ${startDate.toISOString().split('T')[0]}`)
  .and(sql`student_id = ${studentId}`)
  .and(sql`subject = ${subject}`);
```

### Type Definitions

From `src/lib/rpc/types.ts`:

```typescript
interface SubjectStats {
  totalSessions: number;
  averageScore: number;        // 0.0 - 1.0
  longestStreak: number;       // days
  currentStreak: number;       // days
  lastPracticeDate?: string;   // ISO timestamp
  lastPracticeScore?: number;  // 0.0 - 1.0
}

interface SubjectProgress {
  subject: string;
  mastery: number;             // 0.0 - 1.0
  trend: 'up' | 'down' | 'stable';
  trendValue: number;          // change in mastery
  stats: SubjectStats;
}

interface SubjectTimeline {
  date: string;                // YYYY-MM-DD
  mastery: number;             // 0.0 - 1.0
  sessionCount: number;
  averageScore: number;
}
```

### File Locations

**Components:**
- `src/components/progress/SubjectProgressOverview.tsx` - 8 subject cards
- `src/components/progress/SubjectDetailView.tsx` - Single subject detail
- `src/components/progress/SubjectProgressTimeline.tsx` - Mastery timeline chart
- `src/components/progress/SubjectComparisonChart.tsx` - All subjects comparison
- `src/components/progress/PracticeStatistics.tsx` - Stats display

**Utilities:**
- `src/lib/mastery/statistics.ts` - Stats calculation functions
- `src/lib/mastery/timeline.ts` - Timeline data aggregation

**Durable Object:**
- `src/durable-objects/StudentCompanion.ts` - getSubjectStats() RPC method

**RPC:**
- `src/lib/rpc/types.ts` - SubjectStats, SubjectProgress, SubjectTimeline types
- `src/lib/rpc/client.ts` - getSubjectStats() method with React Query

**Tests:**
- `src/lib/mastery/statistics.test.ts` - Stats calculation tests
- `src/components/progress/SubjectProgressOverview.test.tsx`
- `src/components/progress/SubjectDetailView.test.tsx`
- `src/components/progress/SubjectProgressTimeline.test.tsx`
- `src/components/progress/SubjectComparisonChart.test.tsx`
- `src/components/progress/ProgressFlow.test.tsx` - Integration tests

### Story Dependencies

This story depends on:
- **Story 4.3:** Subject Knowledge Tracking (mastery data source)
- **Story 3.3:** Practice Session Completion (practice history data)
- **Story 3.5:** Multi-Dimensional Progress Tracking (existing ProgressCard to extend)

This story enables:
- Future: Personalized recommendations based on weak subjects
- Future: Adaptive tutoring scheduling (focus sessions on weakest subjects)

### Styling and UX

**Color Scheme (Mastery Ranges):**
- 0-30% (Red): `#ef4444` - Needs significant work
- 30-70% (Yellow): `#f59e0b` - Building competency
- 70-100% (Green): `#10b981` - Strong mastery

**Typography:**
- Subject name: Large heading (24px, bold)
- Mastery percentage: Extra large (48px, bold)
- Statistics labels: Small (12px, muted)
- Chart axis labels: Small (12px)

**Spacing:**
- Card padding: 16px (mobile), 24px (desktop)
- Grid gap: 16px
- Section margin: 24px
- Component margin: 32px

**Responsive Breakpoints:**
- Mobile: < 768px
- Tablet: 768px - 1024px
- Desktop: > 1024px

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-11-09 | 1.0 | Story drafted. Comprehensive subject-specific progress views with overview, detail view, mastery timeline, comparison chart, and practice statistics. Estimated 30 hours for implementation. | Bob (SM) |
| 2025-11-09 | 1.1 | Story finalized for development. Enhanced acceptance criteria with clarity on existing components (SubjectProgressCard, SubjectDetailView, ProgressOverTimeChart). Updated AC to clarify Story 4.3 dependencies (SUBJECTS constant, subject_mastery table). Refined component architecture to leverage existing components and minimize new work. Updated data requirements to show primary vs secondary sources. Status changed from "draft" to "ready-for-development". | Bob (SM) |

## Notes for Implementation

### Priorities (if time-constrained)

**MVP (Phase 1 - 12 hours):**
1. SubjectProgressOverview (simple grid of subject cards)
2. SubjectDetailView (basic info + simple chart)
3. getSubjectStats RPC method
4. Integration into ProgressCard tabs

**Phase 2 (8 hours):**
5. SubjectProgressTimeline (interactive timeline chart)
6. Practice statistics calculation and display
7. Time range filtering

**Phase 3 (10 hours):**
8. SubjectComparisonChart
9. Navigation to practice from detail view
10. Real-time updates and cache invalidation
11. Accessibility and responsive design
12. Documentation and polish

### Recommended Library Versions

```json
{
  "recharts": "^2.10.0",
  "react-query": "^3.39.0",
  "tailwindcss": "^3.3.0"
}
```

### Testing Strategy

1. **Unit Tests**: Stats calculation, streak logic, mastery formula
2. **Component Tests**: Each component renders and interacts correctly
3. **Integration Tests**: Full flow from overview → detail → practice → update
4. **E2E Tests**: User journey with real data (future enhancement)

### Performance Targets

- Page load: < 2 seconds
- Chart render: < 500ms
- Data update: < 300ms
- Navigation: < 100ms (instant visual feedback)

### Known Risks

1. **Chart Performance**: With many practice sessions, timeline chart could be slow
   - Mitigation: Aggregate data (1 point per day instead of per session)
   - Mitigation: Virtual scrolling for large lists

2. **Data Consistency**: Mastery data comes from two sources (subject_mastery + practice_sessions)
   - Mitigation: Single source of truth (subject_mastery is primary)
   - Mitigation: Practice stats are derived from practice_sessions (separate query)

3. **Cache Invalidation**: React Query invalidation on practice completion
   - Mitigation: Proper dependency tracking
   - Mitigation: Error boundaries for stale data

## QA Notes

This is a **draft** story, ready for finalization before implementation begins.

### Key Decision Points

1. **Chart Library**: Recommend Recharts for React integration
2. **Time Range Default**: 30 days (typical sprint/monthly view)
3. **Sorting Priority**: By mastery (descending) as default, alphabetical as alternative
4. **Performance Strategy**: Lazy load tabs, aggregate chart data

### Questions for Clarification

1. Should comparison chart be radar or bar chart? (Radar recommended for compactness)
2. Should streaks count any practice, or only subject-specific practice?
3. Should we show confidence level in overview cards or only detail view?
4. How many historical points to keep in timeline? (Recommend: last 30 days, aggregated)

### Before Implementation

- [ ] Finalize which chart library to use
- [ ] Create design mockups for UI
- [ ] Clarify trend calculation (based on what time period?)
- [ ] Determine streak rules (any subject vs. specific subject)
- [ ] Define "current streak" end condition (must practice today?)

